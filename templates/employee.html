{% extends "base.html" %}

{% block title %}Submit Report - PSA Report Tool{% endblock %}

{% block content %}
<div class="page-container">
    <div class="page-header">
        <a href="{{ url_for('index') }}" class="back-btn">
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
                stroke-width="2">
                <path d="M19 12H5M12 19l-7-7 7-7" />
            </svg>
            Back to Home
        </a>
        <h1 class="page-title">Submit Daily Report</h1>
        <p class="page-subtitle">Enter your sales performance data for today</p>
    </div>

    <div class="form-container">
        <form id="reportForm" method="POST" action="{{ url_for('employee') }}">

            <!-- Section: Basic Information -->
            <div class="form-section">
                <h3 class="form-section-title">üìã Basic Information</h3>
                <div class="form-grid">
                    <div class="form-group">
                        <label for="employee_name" class="form-label">
                            Employee Name <span class="required">*</span>
                        </label>
                        <input type="text" class="form-control" id="employee_name" name="employee_name"
                            placeholder="Enter your full name" required>
                    </div>

                    <div class="form-group">
                        <label for="brand" class="form-label">
                            Brand <span class="required">*</span>
                        </label>
                        <select class="form-control form-select" id="brand" name="brand" required>
                            <option value="">-- Select Brand --</option>
                            <option value="ENERZAA">ENERZAA</option>
                            <option value="LUVOST">LUVOST</option>
                            <option value="PEAKSHILAJIT">PEAKSHILAJIT</option>
                            <option value="BOXOOS">BOXOOS</option>
                            <option value="CYLEOX">CYLEOX</option>
                            <option value="ROBURSTAGE">ROBURSTAGE</option>
                            <option value="CHICADDONS">CHICADDONS</option>
                            <option value="FEMBURN">FEMBURN</option>
                            <option value="ORANIC EXTRACT">ORANIC EXTRACT</option>
                            <option value="ZOVOST">ZOVOST</option>
                            <option value="VITALIXHAIR">VITALIXHAIR</option>
                            <option value="SYLIARIX">SYLIARIX</option>
                        </select>
                    </div>

                    <div class="form-group">
                        <label for="date_report" class="form-label">
                            Date Report
                        </label>
                        <input type="date" class="form-control" id="date_report" name="date_report">
                    </div>

                    <div class="form-group">
                        <label for="current_balance" class="form-label">
                            Current Balance ($) <span class="required">*</span>
                        </label>
                        <input type="number" class="form-control" id="current_balance" name="current_balance"
                            placeholder="0.00" step="0.01" required>
                    </div>

                    <div class="form-group">
                        <label for="release_date_balance" class="form-label">
                            Release Date of Balance
                        </label>
                        <input type="date" class="form-control" id="release_date_balance" name="release_date_balance">
                    </div>
                </div>
            </div>

            <!-- Section: Orders & Reviews -->
            <div class="form-section">
                <h3 class="form-section-title">üì¶ Orders & Reviews</h3>
                <div class="form-grid">
                    <div class="form-group">
                        <label for="new_orders" class="form-label">
                            New Orders
                        </label>
                        <input type="number" class="form-control" id="new_orders" name="new_orders" placeholder="0"
                            min="0">
                    </div>

                    <div class="form-group">
                        <label for="vine_total_orders" class="form-label">
                            Vine (Total Orders)
                        </label>
                        <input type="number" class="form-control" id="vine_total_orders" name="vine_total_orders"
                            placeholder="0" min="0">
                    </div>

                    <div class="form-group">
                        <label for="current_inventory" class="form-label">
                            Current Inventory
                        </label>
                        <input type="number" class="form-control" id="current_inventory" name="current_inventory"
                            placeholder="0" min="0">
                    </div>

                    <div class="form-group">
                        <label for="average_orders_30_days" class="form-label">
                            Average Orders (Last 30 Days)
                        </label>
                        <input type="number" class="form-control" id="average_orders_30_days"
                            name="average_orders_30_days" placeholder="0.0" step="0.01" min="0">
                    </div>

                    <div class="form-group">
                        <label for="total_unit_sales" class="form-label">
                            Total Unit Sales
                        </label>
                        <input type="number" class="form-control" id="total_unit_sales" name="total_unit_sales"
                            placeholder="0" min="0">
                    </div>

                    <div class="form-group">
                        <label for="new_reviews" class="form-label">
                            New Reviews
                        </label>
                        <input type="number" class="form-control" id="new_reviews" name="new_reviews" placeholder="0"
                            min="0">
                    </div>

                    <div class="form-group">
                        <label for="average_rating" class="form-label">
                            Average Rating (on listing)
                        </label>
                        <input type="number" class="form-control" id="average_rating" name="average_rating"
                            placeholder="0.0" step="0.1" min="0" max="5">
                    </div>
                </div>
            </div>

            <!-- Section: Rankings -->
            <div class="form-section">
                <h3 class="form-section-title">üìä Rankings</h3>
                <div class="form-grid">
                    <div class="form-group">
                        <label for="main_niche_ranking" class="form-label">
                            Main Niche Ranking
                        </label>
                        <input type="number" class="form-control" id="main_niche_ranking" name="main_niche_ranking"
                            placeholder="0" min="0">
                    </div>

                    <div class="form-group">
                        <label for="sub_niche_ranking" class="form-label">
                            Sub Niche Ranking
                        </label>
                        <input type="number" class="form-control" id="sub_niche_ranking" name="sub_niche_ranking"
                            placeholder="0" min="0">
                    </div>
                </div>
            </div>

            <!-- Section: Advertising -->
            <div class="form-section">
                <h3 class="form-section-title">üì¢ Advertising</h3>
                <div class="form-grid">
                    <div class="form-group">
                        <label for="ads_spend_total" class="form-label">
                            Ads Spend Total ($)
                        </label>
                        <input type="number" class="form-control" id="ads_spend_total" name="ads_spend_total"
                            placeholder="0.00" step="0.01" min="0">
                    </div>

                    <div class="form-group">
                        <label for="ads_sales_total" class="form-label">
                            Ads Sales Total ($)
                        </label>
                        <input type="number" class="form-control" id="ads_sales_total" name="ads_sales_total"
                            placeholder="0.00" step="0.01" min="0">
                    </div>

                    <div class="form-group">
                        <label for="ads_sales_today" class="form-label">
                            Ads Sales Today ($)
                        </label>
                        <input type="number" class="form-control" id="ads_sales_today" name="ads_sales_today"
                            placeholder="0.00" step="0.01" min="0">
                    </div>

                    <div class="form-group">
                        <label for="acos" class="form-label">
                            ACOS (%)
                        </label>
                        <input type="number" class="form-control" id="acos" name="acos" placeholder="0.00" step="0.01"
                            min="0">
                    </div>

                    <div class="form-group">
                        <label for="impressions" class="form-label">
                            Impressions
                        </label>
                        <input type="number" class="form-control" id="impressions" name="impressions" placeholder="0"
                            min="0">
                    </div>
                </div>
            </div>

            <!-- Section: Shopify Attributes -->
            <div class="form-section">
                <h3 class="form-section-title">üõí Shopify Attributes</h3>
                <div class="form-grid">
                    <div class="form-group">
                        <label for="shopify_click_throughs" class="form-label">
                            Click-Throughs
                        </label>
                        <input type="number" class="form-control" id="shopify_click_throughs"
                            name="shopify_click_throughs" placeholder="0" min="0">
                    </div>

                    <div class="form-group">
                        <label for="shopify_total_dpv" class="form-label">
                            Total DPV
                        </label>
                        <input type="number" class="form-control" id="shopify_total_dpv" name="shopify_total_dpv"
                            placeholder="0" min="0">
                    </div>

                    <div class="form-group">
                        <label for="shopify_total_atc" class="form-label">
                            Total ATC
                        </label>
                        <input type="number" class="form-control" id="shopify_total_atc" name="shopify_total_atc"
                            placeholder="0" min="0">
                    </div>

                    <div class="form-group">
                        <label for="shopify_total_purchases" class="form-label">
                            Total Purchases
                        </label>
                        <input type="number" class="form-control" id="shopify_total_purchases"
                            name="shopify_total_purchases" placeholder="0" min="0">
                    </div>

                    <div class="form-group">
                        <label for="shopify_total_product_sales" class="form-label">
                            Total Product Sales ($)
                        </label>
                        <input type="number" class="form-control" id="shopify_total_product_sales"
                            name="shopify_total_product_sales" placeholder="0.00" step="0.01" min="0">
                    </div>
                </div>
            </div>

            <!-- Section: Account Status -->
            <div class="form-section">
                <h3 class="form-section-title">üè¶ Account Status</h3>
                <div class="form-grid">
                    <div class="form-group">
                        <label for="account_status_us" class="form-label">
                            Account Status (US) <span class="required">*</span>
                        </label>
                        <select class="form-control form-select" id="account_status_us" name="account_status_us"
                            required>
                            <option value="Healthy">Healthy</option>
                            <option value="Unhealthy">Unhealthy</option>
                        </select>
                    </div>

                    <div class="form-group">
                        <label for="account_status_mexico" class="form-label">
                            Account Status (Mexico) <span class="required">*</span>
                        </label>
                        <select class="form-control form-select" id="account_status_mexico" name="account_status_mexico"
                            required>
                            <option value="Healthy">Healthy</option>
                            <option value="Unhealthy">Unhealthy</option>
                        </select>
                    </div>

                    <div class="form-group">
                        <label for="account_status_canada" class="form-label">
                            Account Status (Canada) <span class="required">*</span>
                        </label>
                        <select class="form-control form-select" id="account_status_canada" name="account_status_canada"
                            required>
                            <option value="Healthy">Healthy</option>
                            <option value="Unhealthy">Unhealthy</option>
                        </select>
                    </div>
                </div>
            </div>

            <!-- Section: Store Status -->
            <div class="form-section">
                <h3 class="form-section-title">üè™ Store Status</h3>
                <div class="form-grid">
                    <div class="form-group">
                        <label for="store_status_us" class="form-label">
                            Store Status (US) <span class="required">*</span>
                        </label>
                        <select class="form-control form-select" id="store_status_us" name="store_status_us" required>
                            <option value="Active">Active</option>
                            <option value="Inactive">Inactive</option>
                        </select>
                    </div>

                    <div class="form-group">
                        <label for="store_status_mexico" class="form-label">
                            Store Status (Mexico) <span class="required">*</span>
                        </label>
                        <select class="form-control form-select" id="store_status_mexico" name="store_status_mexico"
                            required>
                            <option value="Active">Active</option>
                            <option value="Inactive">Inactive</option>
                        </select>
                    </div>

                    <div class="form-group">
                        <label for="store_status_canada" class="form-label">
                            Store Status (Canada) <span class="required">*</span>
                        </label>
                        <select class="form-control form-select" id="store_status_canada" name="store_status_canada"
                            required>
                            <option value="Active">Active</option>
                            <option value="Inactive">Inactive</option>
                        </select>
                    </div>
                </div>
            </div>

            <div class="form-actions">
                <button type="button" class="btn btn-primary btn-submit" onclick="confirmSubmit()">
                    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
                        stroke-width="2">
                        <path d="M19 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h11l5 5v11a2 2 0 0 1-2 2z" />
                        <polyline points="17 21 17 13 7 13 7 21" />
                        <polyline points="7 3 7 8 15 8" />
                    </svg>
                    Save Report
                </button>
            </div>
        </form>
    </div>
</div>

<!-- Confirmation Modal with Data Preview -->
<div class="modal-overlay" id="confirmModal">
    <div class="modal-content modal-preview">
        <div class="modal-header">
            <div class="modal-icon">
                <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
                    stroke-width="2">
                    <circle cx="12" cy="12" r="10" />
                    <path d="M12 16v-4M12 8h.01" />
                </svg>
            </div>
            <h3 class="modal-title">Review Your Report</h3>
            <p class="modal-subtitle">Please review all data before submitting</p>
        </div>

        <div class="preview-container" id="previewContainer">
            <!-- Preview data will be inserted here by JavaScript -->
        </div>

        <div class="modal-actions">
            <button type="button" class="btn btn-secondary" onclick="closeModal()">
                <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
                    stroke-width="2">
                    <path d="M11 17l-5-5 5-5M18 17l-5-5 5-5" />
                </svg>
                Go Back & Edit
            </button>
            <button type="button" class="btn btn-primary" onclick="submitForm()">
                <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
                    stroke-width="2">
                    <path d="M20 6L9 17l-5-5" />
                </svg>
                Confirm & Save
            </button>
        </div>
    </div>
</div>

<style>
    .form-section {
        margin-bottom: 2rem;
        padding-bottom: 2rem;
        border-bottom: 1px solid var(--border-color);
    }

    .form-section:last-of-type {
        border-bottom: none;
        margin-bottom: 0;
        padding-bottom: 0;
    }

    .form-section-title {
        font-size: 1.125rem;
        font-weight: 600;
        color: var(--text-primary);
        margin-bottom: 1.25rem;
        display: flex;
        align-items: center;
        gap: 0.5rem;
    }

    /* Preview Modal Styles */
    .modal-preview {
        max-width: 700px;
        max-height: 85vh;
        display: flex;
        flex-direction: column;
        text-align: left;
    }

    .modal-header {
        text-align: center;
        margin-bottom: 1.5rem;
    }

    .modal-subtitle {
        color: var(--text-secondary);
        font-size: 0.875rem;
        margin-top: 0.5rem;
    }

    .preview-container {
        flex: 1;
        overflow-y: auto;
        max-height: 50vh;
        padding: 0.5rem;
        margin-bottom: 1.5rem;
    }

    .preview-section {
        margin-bottom: 1.5rem;
    }

    .preview-section-title {
        font-size: 0.875rem;
        font-weight: 600;
        color: var(--accent-primary);
        margin-bottom: 0.75rem;
        padding-bottom: 0.5rem;
        border-bottom: 1px solid var(--border-color);
    }

    .preview-grid {
        display: grid;
        grid-template-columns: repeat(2, 1fr);
        gap: 0.5rem 1rem;
    }

    .preview-item {
        display: flex;
        flex-direction: column;
        gap: 0.125rem;
    }

    .preview-label {
        font-size: 0.75rem;
        color: var(--text-muted);
    }

    .preview-value {
        font-size: 0.875rem;
        color: var(--text-primary);
        font-weight: 500;
    }

    .preview-value.empty {
        color: var(--text-muted);
        font-style: italic;
    }

    .modal-actions {
        display: flex;
        gap: 1rem;
        justify-content: center;
        flex-wrap: wrap;
    }

    @media (max-width: 600px) {
        .preview-grid {
            grid-template-columns: 1fr;
        }
    }
</style>
{% endblock %}

{% block scripts %}
<script>
    function confirmSubmit() {
        // Validate required fields first
        const form = document.getElementById('reportForm');
        if (!form.checkValidity()) {
            form.reportValidity();
            return;
        }

        // Generate preview
        generatePreview();

        // Show confirmation modal
        document.getElementById('confirmModal').classList.add('active');
    }

    function generatePreview() {
        const container = document.getElementById('previewContainer');

        const sections = [
            {
                title: 'üìã Basic Information',
                fields: [
                    { label: 'Employee Name', id: 'employee_name' },
                    { label: 'Brand', id: 'brand' },
                    { label: 'Date Report', id: 'date_report' },
                    { label: 'Current Balance', id: 'current_balance', prefix: '$' },
                    { label: 'Release Date of Balance', id: 'release_date_balance' }
                ]
            },
            {
                title: 'üì¶ Orders & Reviews',
                fields: [
                    { label: 'New Orders', id: 'new_orders' },
                    { label: 'Vine (Total Orders)', id: 'vine_total_orders' },
                    { label: 'Current Inventory', id: 'current_inventory' },
                    { label: 'Avg Orders (30 Days)', id: 'average_orders_30_days' },
                    { label: 'Total Unit Sales', id: 'total_unit_sales' },
                    { label: 'New Reviews', id: 'new_reviews' },
                    { label: 'Average Rating', id: 'average_rating' }
                ]
            },
            {
                title: 'üìä Rankings',
                fields: [
                    { label: 'Main Niche Ranking', id: 'main_niche_ranking' },
                    { label: 'Sub Niche Ranking', id: 'sub_niche_ranking' }
                ]
            },
            {
                title: 'üì¢ Advertising',
                fields: [
                    { label: 'Ads Spend Total', id: 'ads_spend_total', prefix: '$' },
                    { label: 'Ads Sales Total', id: 'ads_sales_total', prefix: '$' },
                    { label: 'Ads Sales Today', id: 'ads_sales_today', prefix: '$' },
                    { label: 'ACOS', id: 'acos', suffix: '%' },
                    { label: 'Impressions', id: 'impressions' }
                ]
            },
            {
                title: 'üõí Shopify Attributes',
                fields: [
                    { label: 'Click-Throughs', id: 'shopify_click_throughs' },
                    { label: 'Total DPV', id: 'shopify_total_dpv' },
                    { label: 'Total ATC', id: 'shopify_total_atc' },
                    { label: 'Total Purchases', id: 'shopify_total_purchases' },
                    { label: 'Total Product Sales', id: 'shopify_total_product_sales', prefix: '$' }
                ]
            },
            {
                title: 'üè¶ Account Status',
                fields: [
                    { label: 'Account Status (US)', id: 'account_status_us' },
                    { label: 'Account Status (Mexico)', id: 'account_status_mexico' },
                    { label: 'Account Status (Canada)', id: 'account_status_canada' }
                ]
            },
            {
                title: 'üè™ Store Status',
                fields: [
                    { label: 'Store Status (US)', id: 'store_status_us' },
                    { label: 'Store Status (Mexico)', id: 'store_status_mexico' },
                    { label: 'Store Status (Canada)', id: 'store_status_canada' }
                ]
            }
        ];

        let html = '';
        sections.forEach(section => {
            html += `<div class="preview-section">
                <div class="preview-section-title">${section.title}</div>
                <div class="preview-grid">`;

            section.fields.forEach(field => {
                const element = document.getElementById(field.id);
                let value = element ? element.value : '';

                if (value && field.prefix) value = field.prefix + value;
                if (value && field.suffix) value = value + field.suffix;

                const displayValue = value || '(not provided)';
                const emptyClass = value ? '' : 'empty';

                html += `<div class="preview-item">
                    <span class="preview-label">${field.label}</span>
                    <span class="preview-value ${emptyClass}">${displayValue}</span>
                </div>`;
            });

            html += `</div></div>`;
        });

        container.innerHTML = html;
    }

    function closeModal() {
        document.getElementById('confirmModal').classList.remove('active');
    }

    function submitForm() {
        document.getElementById('reportForm').submit();
    }

    // Close modal on escape key
    document.addEventListener('keydown', function (e) {
        if (e.key === 'Escape') {
            closeModal();
        }
    });

    // Close modal on overlay click
    document.getElementById('confirmModal').addEventListener('click', function (e) {
        if (e.target === this) {
            closeModal();
        }
    });
</script>
{% endblock %}